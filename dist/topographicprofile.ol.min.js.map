{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/templates/perfiltopografico.html","webpack:///./src/facade/js/i18n/language.js","webpack:///./src/impl/ol/js/profilcontrol.js","webpack:///./src/impl/ol/js/topographicprofilecontrol.js","webpack:///./src/facade/js/topographicprofilecontrol.js","webpack:///./src/facade/js/topographicprofile.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","translations","en","es","getLang","res","M","language","getTranslation","lang","getValue","keyPath","arguments","length","undefined","translation","utils","isNullOrEmpty","console","warn","concat","split","reduce","prev","current","info","Profil","_ol$control$Control","_inherits","olcontrolProfil","ol","control","Control","_super","_createSuper","opt_options","_this","_classCallCheck","element","options","target","document","createElement","classList","add","className","trim","elementTitle","textContent","appendChild","button","setAttribute","close","e","map","removeControl","_assertThisInitialized","source","clear","addEventListener","button2","download","image","getImage","a","href","click","remove","div_inner","div","style","position","self","ratio","canvas_","width","height","styles","keys","forEach","div_to_canvas","onMove","margin_","top","left","bottom","right","ytitle","xtitle","bar_","cursor_","popup_","cellPadding","cellSpacing","clientWidth","firstTr","div_zmin","innerHTML","zmin","div_zmax","zmax","div_distance","distance","secondTr","div_altitude","altitude","div_distance2","div_time2","time","tab_","feature","setGeometry","this","box_canvas","getBoundingClientRect","pos","window","pageYOffset","documentElement","clientTop","pageXOffset","clientLeft","dx","pageX","dy","pageY","display","scale_","p0","dy_","parentElement","querySelector","altitudeUnits","toFixed","distanceUnitsKM","dispatchEvent","type","coord","contains","show","toggle","b","g","Feature","getGeometry","canvas","ctx","getContext","w","h","setTransform","clearRect","test","getLayout","getCoordinates","getType","proj","projection","getMap","getView","getProjection","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","z","ti","p1","p2","Infinity","sphere","getDistance","transform","getTime","push","distanceUnitsM","grad","graduation","Math","ceil","floor","amplitude","max","scx","scy","font","textAlign","textBaseline","fillStyle","zunit","fillText","setLineDash","step","unit","round","txt","replace","save","rotate","PI","restore","t0","t1","dt","trunc","mn","encoderOptions","toDataURL","PROFILE_URL","PROFILE_URL_SUFFIX","TopographicprofileControl","_M$impl$Control","impl","opts","_ref","serviceURL","distancePoinst_","mercator_","coordEPSG4326","_ref2","projectionMap_","profil_","facadeMap_","vector_","source_","vectorProfile_","sourceProfile_","draw_","lineCoord_","pointsCoord_","dataPoints_","pt","_ref3","lineString_","feature_","style_","layer_","layer","mode_","includesAltitude_","forcews","wcs","url","version","coverage","interpolationMethod","format","html","String","getLayers","initOlLayers","_get","_getPrototypeOf","activate","evt","Style","Stroke","color","Circle","radius","fill","Fill","Vector","wrapX","setZIndex","getMapImpl","addLayer","code","originPoint","destPoint","addX","addY","points","oriMete","destMete","angle","getAngleBetweenPoints","getDistBetweenPoints","slice","distPoint","newPointA","cos","sin","newPointB","firstPoint","secondPoint","geom","LineString","getLength","atan2","createIteraction","addInteraction","typeGeom","interaction","Draw","on","clearLayer","findNewPoints","getDataFromService","getFeatures","coordinates","arrayXZY","controlProfile","setCoordinates","_this2","body","cursor","pointsBbox","altitudes","promises","filter","elem","bbox","remote","Promise","all","then","responses","response","text","alt","item","parseFloat","data","index","center","extent","getCenter","arrayXZY2","error","log","dialog","geometry","addFeature","addControl","drawPoint","Point","Icon","anchor","anchorXUnits","anchorYUnits","src","setStyle","once","getState","popup","removeInteraction","hide","deactivate","removeLayer","_M$Control","isUndefined","TopographicprofileImplControl","exception","btnData_","btnRemove_","html_","drawCtrl_","template","compileSync","string","parseToHtml","templateVars","vars","htmlText","Handlebars","compile","templateFn","stringToHtml","success","fail","template_","title","Topographicprofile","_M$Plugin","Plugin","map_","controls_","position_","metadata_","api","metadata","panel_","control_","options_","ui","Panel","addControls","ADDED_TO_MAP","fire","addPanels","removeControls","plugin","M$plugin$Topographicprofile","Topographicprofilecontrol","M$control$Topographicprofilecontrol","M$impl$control$TopographicprofileControl"],"mappings":"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","file":"topographicprofile.ol.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = \"<div class=\\\"m-control m-container m-topographicprofile-container\\\">\\r\\n    <button id='m-topographicprofile-btn' class=\\\"m-topographicprofile-btn icon-chart\\\"></button>\\r\\n</div>\\r\\n\";","import en from './en';\nimport es from './es';\n\n/**\n * Default object with es and en translate.\n *\n * @const\n * @type {object}\n */\nconst translations = {\n  en,\n  es,\n};\n\nconst getLang = () => {\n  let res = 'es';\n  if (typeof M.language.getLang === 'function') {\n    res = M.language.getLang();\n  }\n\n  return res;\n};\n\n/**\n * This function sets a new language translate.\n * @param {string} lang\n * @param {JSON} json\n * @public\n * @api\n */\nexport const addTranslation = (lang, json) => {\n  translations[lang] = json;\n};\n\n/**\n * This function gets a language translate.\n *\n * @param {string} lang\n * @return {JSON}\n * @public\n * @api\n */\nexport const getTranslation = (lang) => {\n  return translations[lang];\n};\n\n/**\n * This function gets a language value from key\n *\n * @public\n * @param {string}\n * @param {string}\n * @return {string}\n * @public\n * @api\n */\n\nexport const getValue = (keyPath, lang = getLang()) => {\n  const translation = getTranslation(lang);\n  let value = '';\n  if (M.utils.isNullOrEmpty(translation)) {\n    /* eslint-disable no-console */\n    console.warn(`The translation '${lang}' has not been defined.`);\n  } else {\n    value = keyPath.split('.').reduce((prev, current) => prev[current], translation);\n  }\n\n  return value;\n};\n","/*    Copyright (c) 2016 Jean-Marc VIGLINO,\n    released under the CeCILL-B license (French BSD license)\n    (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\n*/\n/*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n\n/*import ol_ext_inherits from '../util/ext'\nimport { getDistance as ol_sphere_getDistance } from 'ol/sphere'\nimport { transform as ol_proj_transform } from 'ol/proj'\nimport ol_control_Control from 'ol/control/Control'\nimport ol_Feature from 'ol/Feature'*/\n\nimport { getValue } from '../../../facade/js/i18n/language';\n//import ol_control_Control from 'ol/control/Control'\n\n/* const inherits = (child, parent) => {\n  child.prototype = Object.create(parent.prototype);\n  child.prototype.constructor = child;\n}; /\n\n/** Custom infos list\n * @api stable\n */\nconst info = {\n  \"zmin\": \"Zmin\",\n  \"zmax\": \"Zmax\",\n  \"ytitle\": \"Altitude (m)\",\n  \"xtitle\": \"Distance (km)\",\n  \"time\": \"Time\",\n  \"altitude\": \"Altitude\",\n  \"distance\": \"Distance\",\n  \"altitudeUnits\": \"m\",\n  \"distanceUnitsM\": \"m\",\n  \"distanceUnitsKM\": \"km\",\n};\n\n\n\n/*eslint-disable*/\n\n/**\n * @classdesc OpenLayers 3 Profil Control.\n *    Draw a profil of a feature (with a 3D geometry)\n *\n * @constructor\n * @extends {ol_control_Control}\n * @fires  over, out, show\n * @param {Object=} _ol_control_ opt_options.\n *\n */\nvar Profil = class olcontrolProfil extends ol.control.Control {\nconstructor(opt_options) {\n  var options = opt_options || {};\n\n  var element;\n  if (options.target) {\n    element = document.createElement(\"div\");\n    element.classList.add(options.className || \"ol-profil\");\n  } else {\n    element = document.createElement(\"div\");\n    element.className = ((options.className || 'ol-profil') + ' ol-unselectable ol-control ol-collapsed').trim();\n    let elementTitle = document.createElement('p');\n    elementTitle.textContent = getValue('profil.title');\n    element.appendChild(elementTitle);\n    // let cross = document.createElement('button');\n    // cross.className = 'cross';\n    // element.appendChild(cross);\n    // cross.addEventListener(\"click\", function(e) {\n\n    // })\n    const button = document.createElement('button');\n    button.setAttribute('type', 'button');\n    button.setAttribute('class', 'profile-close-button');\n    const close = (e) => {\n      opt_options.map.removeControl(this);\n      options.source.clear();\n    };\n    button.addEventListener('click', close);\n    button.addEventListener('touchstart', close);\n    elementTitle.appendChild(button);\n\n    const button2 = document.createElement('button');\n    button2.setAttribute('type', 'button');\n    button2.setAttribute('class', 'profile-download-button');\n    const download = (e) => {\n      const image = this.getImage();\n      const a = document.createElement('a');\n      a.href = image;\n      a.download = 'Perfil.png';\n      a.click();\n      a.remove();\n    };\n    button2.addEventListener('click', download);\n    button2.addEventListener('touchstart', download);\n    elementTitle.appendChild(button2);\n  }\n\n  var div_inner = document.createElement(\"div\");\n  div_inner.classList.add(\"ol-inner\");\n  element.appendChild(div_inner);\n  var div = document.createElement(\"div\");\n  div.style.position = \"relative\";\n  div_inner.appendChild(div);\n\n  super({\n    element: element,\n    target: options.target\n  });\n\n  this.info = options.info || info;\n  var self = this;\n\n  var ratio = this.ratio = 2;\n  this.canvas_ = document.createElement('canvas');\n  this.canvas_.width = (options.width || 300) * ratio;\n  this.canvas_.height = (options.height || 150) * ratio;\n\n  var styles = {\n    \"msTransform\": \"scale(0.5,0.5)\",\n    \"msTransformOrigin\": \"0 0\",\n    \"webkitTransform\": \"scale(0.5,0.5)\",\n    \"webkitTransformOrigin\": \"0 0\",\n    \"mozTransform\": \"scale(0.5,0.5)\",\n    \"mozTransformOrigin\": \"0 0\",\n    \"transform\": \"scale(0.5,0.5)\",\n    \"transformOrigin\": \"0 0\"\n  };\n\n  Object.keys(styles).forEach(function(style) {\n    if (style in self.canvas_.style) {\n      self.canvas_.style[style] = styles[style];\n    }\n  });\n\n  var div_to_canvas = document.createElement(\"div\");\n  div.appendChild(div_to_canvas);\n  div_to_canvas.style.width = this.canvas_.width / ratio + \"px\";\n  div_to_canvas.style.height = this.canvas_.height / ratio + \"px\";\n  div_to_canvas.appendChild(this.canvas_);\n  div_to_canvas.addEventListener(\"click\", function(e) { self.onMove(e); });\n  div_to_canvas.addEventListener(\"mousemove\", function(e) { self.onMove(e); });\n\n  // Offset in px\n  this.margin_ = { top: 10 * ratio, left: 40 * ratio, bottom: 30 * ratio, right: 10 * ratio };\n  if (!this.info.ytitle) this.margin_.left -= 20 * ratio;\n  if (!this.info.xtitle) this.margin_.bottom -= 20 * ratio;\n\n  // Cursor\n  this.bar_ = document.createElement(\"div\");\n  this.bar_.classList.add(\"ol-profilbar\");\n  this.bar_.style.top = (this.margin_.top / ratio) + \"px\";\n  this.bar_.style.height = (this.canvas_.height - this.margin_.top - this.margin_.bottom) / ratio + \"px\";\n  div.appendChild(this.bar_);\n\n  this.cursor_ = document.createElement(\"div\");\n  this.cursor_.classList.add(\"ol-profilcursor\");\n  div.appendChild(this.cursor_);\n\n  this.popup_ = document.createElement(\"div\");\n  this.popup_.classList.add(\"ol-profilpopup\");\n  this.cursor_.appendChild(this.popup_);\n\n  // Track information\n  var t = document.createElement(\"table\");\n  t.cellPadding = '0';\n  t.cellSpacing = '0';\n  t.style.clientWidth = this.canvas_.width / ratio + \"px\";\n  div.appendChild(t);\n\n  var firstTr = document.createElement(\"tr\");\n  firstTr.classList.add(\"track-info\");\n  t.appendChild(firstTr);\n  var div_zmin = document.createElement(\"td\");\n  div_zmin.innerHTML = (this.info.zmin || \"Zmin\") + ': <span class=\"zmin\">';\n  firstTr.appendChild(div_zmin);\n  var div_zmax = document.createElement(\"td\");\n  div_zmax.innerHTML = (this.info.zmax || \"Zmax\") + ': <span class=\"zmax\">';\n  firstTr.appendChild(div_zmax);\n  var div_distance = document.createElement(\"td\");\n  div_distance.innerHTML = (this.info.distance || \"Distance\") + ': <span class=\"dist\">';\n  firstTr.appendChild(div_distance);\n  //var div_time = document.createElement(\"td\");\n  //div_time.innerHTML = (this.info.time || \"Time\") + ': <span class=\"time\">';\n  //firstTr.appendChild(div_time);\n  var secondTr = document.createElement(\"tr\");\n  secondTr.classList.add(\"point-info\")\n  t.appendChild(secondTr);\n  var div_altitude = document.createElement(\"td\");\n  div_altitude.innerHTML = (this.info.altitude || \"Altitude\") + ': <span class=\"z\">';\n  secondTr.appendChild(div_altitude);\n  var div_distance2 = document.createElement(\"td\");\n  div_distance2.innerHTML = (\"Dist. parcial\") + ': <span class=\"dist\">';\n  secondTr.appendChild(div_distance2);\n  var div_time2 = document.createElement(\"td\");\n  div_time2.innerHTML = (this.info.time || \"Time\") + ': <span class=\"time\">';\n  secondTr.appendChild(div_time2);\n\n  // Array of data\n  this.tab_ = [];\n\n  // Show feature\n  if (options.feature) {\n    this.setGeometry(options.feature);\n  }\n};\n// inherits(Profil, ol.control.Control);\n\n/** Show popup info\n * @param {string} info to display as a popup\n * @api stable\n */\npopup(info) {\n  this.popup_.innerHTML = info;\n}\n\n/** Mouse move over canvas\n */\nonMove(e) {\n  if (!this.tab_.length) return;\n  var box_canvas = this.canvas_.getBoundingClientRect();\n  var pos = {\n    top: box_canvas.top + window.pageYOffset - document.documentElement.clientTop,\n    left: box_canvas.left + window.pageXOffset - document.documentElement.clientLeft\n  };\n\n  var dx = e.pageX - pos.left;\n  var dy = e.pageY - pos.top;\n  var ratio = this.ratio;\n  if (dx > this.margin_.left / ratio && dx < (this.canvas_.width - this.margin_.right) / ratio &&\n    dy > this.margin_.top / ratio && dy < (this.canvas_.height - this.margin_.bottom) / ratio) {\n    this.bar_.style.left = dx + \"px\";\n    this.bar_.style.display = \"block\";\n    var d = (dx * ratio - this.margin_.left) / this.scale_[0];\n    var p0 = this.tab_[0];\n    for (var i = 1, p; p = this.tab_[i]; i++) {\n      if (p[0] >= d) {\n        if (d < (p[0] + p0[0]) / 2) p = p0;\n        break;\n      }\n    }\n    if (p) {\n      this.cursor_.style.left = dx + \"px\";\n      this.cursor_.style.top = (this.canvas_.height - this.margin_.bottom + p[1] * this.scale_[1] + this.dy_) / ratio + \"px\";\n      this.cursor_.style.display = \"block\";\n    } else {\n      this.cursor_.style.display = \"none\";\n    }\n    this.bar_.parentElement.classList.add(\"over\");\n    this.element.querySelector(\".point-info .z\").textContent = p[1] + this.info.altitudeUnits;\n    this.element.querySelector(\".point-info .dist\").textContent = (p[0] / 1000).toFixed(1) + this.info.distanceUnitsKM;\n    this.element.querySelector(\".point-info .time\").textContent = p[2];\n    if (dx > this.canvas_.width / ratio / 2) this.popup_.classList.add('ol-left');\n    else this.popup_.classList.remove('ol-left');\n    this.dispatchEvent({ type: 'over', click: e.type == \"click\", coord: p[3], time: p[2], distance: p[0] });\n  } else {\n    if (this.bar_.parentElement.classList.contains(\"over\")) {\n      this.bar_.style.display = 'none';\n      this.cursor_.style.display = 'none';\n      this.bar_.parentElement.classList.remove(\"over\");\n      this.dispatchEvent({ type: 'out' });\n    }\n  }\n}\n\n/** Show panel\n * @api stable\n */\nshow() {\n  this.element.classList.remove(\"ol-collapsed\");\n  this.dispatchEvent({ type: 'show', show: true });\n}\n/** Hide panel\n * @api stable\n */\nhide() {\n  this.element.classList.add(\"ol-collapsed\");\n  this.dispatchEvent({ type: 'show', show: false });\n}\n/** Toggle panel\n * @api stable\n */\ntoggle() {\n  this.element.classList.toggle(\"ol-collapsed\");\n  var b = this.element.classList.contains(\"ol-collapsed\");\n  this.dispatchEvent({ type: 'show', show: !b });\n}\n/** Is panel visible\n */\nisShown() {\n  return (!this.element.classList.contains(\"ol-collapsed\"));\n}\n\n/**\n * Set the geometry to draw the profil.\n * @param {ol.Feature|ol.geom} f the feature.\n * @param {Object=} options\n *        - projection {ol.ProjectionLike} feature projection, default projection of the map\n *        - zunit {m|km} default m\n *        - unit {m|km} default km\n *        - zmin {Number|undefined} default 0\n *        - zmax {Number|undefined} default max Z of the feature\n *        - graduation {Number|undefined} z graduation default 100\n *        - amplitude {integer|undefined} amplitude of the altitude, default zmax-zmin\n * @api stable\n */\nsetGeometry(g, options) {\n  if (!options) options = {};\n  if (g instanceof ol.Feature) g = g.getGeometry();\n  var canvas = this.canvas_;\n  var ctx = canvas.getContext('2d');\n  var w = canvas.width;\n  var h = canvas.height;\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n  ctx.clearRect(0, 0, w, h);\n\n  // No Z\n  if (!/Z/.test(g.getLayout())) return;\n  // No time\n  if (/M/.test(g.getLayout())) this.element.querySelector(\".time\").parentElement.style.display = 'block';\n  else this.element.querySelector(\".time\").parentElement.style.display = 'none';\n\n  // Coords\n  var c = g.getCoordinates();\n\n  switch (g.getType()) {\n    case \"LineString\":\n      break;\n    case \"MultiLineString\":\n      c = c[0];\n      break;\n    default:\n      return;\n  }\n\n  /*// Distance beetween 2 coords\n  var proj = options.projection || this.getMap().getView().getProjection();\n\n  function dist2d(p1, p2) {\n    const distancia = ol.sphere.getDistance(\n      ol.proj.transform(p1.map(coord => parseFloat(coord)), 'EPSG:4326', 'EPSG:4326'),\n      ol.proj.transform(p2.map(coord => parseFloat(coord)), 'EPSG:4326', 'EPSG:4326'));\n\n    return distancia;\n\n  }*/\n\n\n  // Distance beetween 2 coords\n  var proj = options.projection || this.getMap().getView().getProjection();\n\n\n  function dist2d(p1, p2) {\n    return ol.sphere.getDistance(\n      ol.proj.transform(p1, proj, 'EPSG:4326'),\n      ol.proj.transform(p2, proj, 'EPSG:4326'))\n  }\n\n  function getTime(t0, t1) {\n    if (!t0 || !t1) return \"-\"\n    var dt = (t1 - t0) / 60; // mn\n    var ti = Math.trunc(dt / 60);\n    var mn = Math.trunc(dt - ti * 60);\n    return ti + \"h\" + (mn < 10 ? \"0\" : \"\") + mn + \"mn\";\n  }\n\n  // Margin\n  ctx.setTransform(1, 0, 0, 1, this.margin_.left, h - this.margin_.bottom);\n  var ratio = this.ratio;\n\n  w -= this.margin_.right + this.margin_.left;\n  h -= this.margin_.top + this.margin_.bottom;\n  // Draw axes\n  ctx.strokeStyle = \"#000\";\n  ctx.lineWidth = 0.5 * ratio;\n  ctx.beginPath();\n  ctx.moveTo(0, 0);\n  ctx.lineTo(0, -h);\n  ctx.moveTo(0, 0);\n  ctx.lineTo(w, 0);\n  ctx.stroke();\n\n  //\n  var zmin = Infinity,\n    zmax = -Infinity;\n  var i, p, d, z, ti, t = this.tab_ = [];\n  for (i = 0, p; p = c[i]; i++) {\n    z = p[2];\n    if (z < zmin) zmin = z;\n    if (z > zmax) zmax = z;\n    if (i == 0) d = 0;\n    else d += dist2d(c[i - 1], p);\n    ti = getTime(c[0][3], p[3]);\n    t.push([d, z, ti, p]);\n  }\n\n  // Info\n  this.element.querySelector(\".track-info .zmin\").textContent = zmin.toFixed(2) + this.info.altitudeUnits;\n  this.element.querySelector(\".track-info .zmax\").textContent = zmax.toFixed(2) + this.info.altitudeUnits;\n  if (d > 1000) {\n    this.element.querySelector(\".track-info .dist\").textContent = (d / 1000).toFixed(1) + this.info.distanceUnitsKM;\n  } else {\n    this.element.querySelector(\".track-info .dist\").textContent = (d).toFixed(1) + this.info.distanceUnitsM;\n  }\n  //this.element.querySelector(\".track-info .time\").textContent = ti;\n\n  // Set graduation\n  var grad = options.graduation || 100;\n  while (true) {\n    zmax = Math.ceil(zmax / grad) * grad;\n    zmin = Math.floor(zmin / grad) * grad;\n    var nbgrad = (zmax - zmin) / grad;\n    if (h / nbgrad < 15 * ratio) {\n      grad *= 2;\n    } else break;\n  }\n\n  // Set amplitude\n  if (typeof(options.zmin) == 'number' && zmin > options.zmin) zmin = options.zmin;\n  if (typeof(options.zmax) == 'number' && zmax < options.zmax) zmax = options.zmax;\n  var amplitude = options.amplitude;\n  if (amplitude) {\n    zmax = Math.max(zmin + amplitude, zmax);\n  }\n\n  // Scales lines\n  var scx = w / d;\n  var scy = -h / (zmax - zmin);\n  var dy = this.dy_ = -zmin * scy;\n  this.scale_ = [scx, scy];\n  // Draw\n  ctx.font = (10 * ratio) + \"px arial\";\n  ctx.textAlign = \"right\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillStyle = \"#000\";\n  // Scale Z\n  ctx.beginPath();\n  for (i = zmin; i <= zmax; i += grad) {\n    if (options.zunit != \"km\") ctx.fillText(i, -4 * ratio, i * scy + dy);\n    else ctx.fillText((i / 1000).toFixed(1), -4 * ratio, i * scy + dy);\n    ctx.moveTo(-2 * ratio, i * scy + dy);\n    if (i != 0) ctx.lineTo(d * scx, i * scy + dy);\n    else ctx.lineTo(0, i * scy + dy);\n  }\n  // Scale X\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"top\";\n  ctx.setLineDash([ratio, 3 * ratio]);\n  var unit = options.unit || \"km\";\n  var step;\n  if (d > 1000) {\n    step = Math.round(d / 1000) * 100;\n    if (step > 1000) step = Math.ceil(step / 1000) * 1000;\n  } else {\n    unit = \"m\";\n    if (d > 100) step = Math.round(d / 100) * 10;\n    else if (d > 10) step = Math.round(d / 10);\n    else if (d > 1) step = Math.round(d) / 10;\n    else step = d;\n  }\n  for (i = 0; i <= d; i += step) {\n    var txt = (unit == \"m\") ? i : (i / 1000);\n    //if (i+step>d) txt += \" \"+ (options.zunits || \"km\");\n    ctx.fillText(Math.round(txt * 10) / 10, i * scx, 4 * ratio);\n    ctx.moveTo(i * scx, 2 * ratio);\n    ctx.lineTo(i * scx, 0);\n  }\n  ctx.font = (12 * ratio) + \"px arial\";\n  ctx.fillText(this.info.xtitle.replace(\"(km)\", \"(\" + unit + \")\"), w / 2, 18 * ratio);\n  ctx.save();\n  ctx.rotate(-Math.PI / 2);\n  ctx.fillText(this.info.ytitle, h / 2, -this.margin_.left);\n  ctx.restore();\n\n  ctx.stroke();\n\n  //\n  ctx.strokeStyle = \"#368\";\n  ctx.lineWidth = 3;\n  ctx.setLineDash([]);\n  ctx.beginPath();\n  for (i = 0; p = t[i]; i++) {\n    if (i == 0) ctx.moveTo(p[0] * scx, p[1] * scy + dy);\n    else ctx.lineTo(p[0] * scx, p[1] * scy + dy);\n  }\n  ctx.stroke();\n};\n\n/** Get profil image\n * @param {string|undefined} type image format or 'canvas' to get the canvas image, default image/png.\n * @param {Number|undefined} encoderOptions between 0 and 1 indicating image quality image/jpeg or image/webp, default 0.92.\n * @return {string} requested data uri\n * @api stable\n */\ngetImage(type, encoderOptions) {\n  if (type === \"canvas\") return this.canvas_;\n  return this.canvas_.toDataURL(type, encoderOptions);\n}\n}\nexport default Profil\n","/* eslint-disable no-console */\r\n/**\r\n * @module M/impl/control/TopographicprofileControl\r\n */\r\nimport Profil from './profilcontrol';\r\nimport { getValue } from '../../../facade/js/i18n/language';\r\n\r\n//let PROFILE_URL = 'https://servicios.idee.es/wcs-inspire/mdt?request=GetCoverage&bbox=';\r\n//let PROFILE_URL_SUFFIX = '&service=WCS&version=1.0.0&coverage=Elevacion4258_500&' +\r\n//  'interpolationMethod=bilinear&crs=EPSG%3A4258&format=ArcGrid&width=2&height=2';\r\nlet PROFILE_URL = 'https://www.juntadeandalucia.es/medioambiente/mapwms/REDIAM_WCS_mdt?request=GetCoverage&bbox=';\r\nlet PROFILE_URL_SUFFIX = '&service=WCS&version=1.0.0&coverage=Modelo%20Digital%20de%20Elevaciones%20(MDE)%20de%20Andalucia%20100%20m&' +\r\n  'interpolationMethod=bilinear&crs=EPSG%3A4258&format=image%2Fx-aaigrid&width=2&height=2';\r\n\r\nexport default class TopographicprofileControl extends M.impl.Control {\r\n\r\n  constructor(opts) {\r\n\r\n    super();\r\n    [this.distancePoinst_, this.mercator_, this.serviceURL, this.coordEPSG4326] = [30, 'EPSG:900913', opts.serviceURL, \"EPSG:4326\"];\r\n    [this.projectionMap_, this.profil_, this.facadeMap_, this.vector_, this.source_, this.vectorProfile_, this.sourceProfile_, this.draw_, this.lineCoord_, this.pointsCoord_, this.dataPoints_, this.pt] = [null, null, null, null, null, null, null, null, null, null, null, null];\r\n    [this.lineString_, this.feature_, this.style_] = [null, null, null];\r\n    this.layer_ = opts.layer;\r\n    this.mode_ =(opts.mode? opts.mode : 'interactive');\r\n    this.includesAltitude_ = false;\r\n    this.forcews = opts.forcews;\r\n\r\n    if(opts.wcs) {\r\n      PROFILE_URL = opts.wcs.url + '?request=GetCoverage&bbox=';\r\n      PROFILE_URL_SUFFIX = '&service=WCS&version=' + opts.wcs.version + '&coverage=' + opts.wcs.coverage + '&' +\r\n      'interpolationMethod=' + opts.wcs.interpolationMethod + '&crs=EPSG%3A4258&format=' + opts.wcs.format + '&width=2&height=2';\r\n    } \r\n\r\n  }\r\n\r\n  /**\r\n   * This function adds the control to the specified map\r\n   *\r\n   * @public\r\n   * @function\r\n   * @param {M.Map} map to add the plugin\r\n   * @param {HTMLElement} html of the plugin\r\n   * @api stable\r\n   */\r\n  addTo(map, html) {\r\n    this.facadeMap_ = map;\r\n    // Si la capa la ha pasado por nombre\r\n    if(this.layer_ && (typeof this.layer_ === 'string' || this.layer_ instanceof String)) {\r\n      this.layer_ = this.facadeMap_.getLayers({'name':this.layer_})[0];\r\n     } \r\n    this.initOlLayers();\r\n    // super addTo - don't delete\r\n    super.addTo(map, html);\r\n    if(this.mode_ == 'fixed') {\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  // Add your own functions\r\n  initOlLayers() {\r\n    this.style_ = function(evt) {\r\n      let style;\r\n      if (evt.getGeometry().getType() == 'LineString') {\r\n        style = [new ol.style.Style({\r\n          stroke: new ol.style.Stroke({\r\n            color: '#4286f4',\r\n            width: 2\r\n          })\r\n        })];\r\n      } else {\r\n        style = [new ol.style.Style({\r\n          image: new ol.style.Circle({\r\n            radius: 6,\r\n            fill: new ol.style.Fill({\r\n              color: '#4286f4'\r\n            })\r\n          }),\r\n          stroke: new ol.style.Stroke({\r\n            color: '#4286f4',\r\n            width: 2\r\n          }),\r\n          fill: new ol.style.Fill({\r\n            color: '#4286f4'\r\n          })\r\n        })];\r\n      }\r\n      return style;\r\n    }\r\n    this.source_ = new ol.source.Vector({\r\n      wrapX: false\r\n    });\r\n    this.vector_ = new ol.layer.Vector({\r\n      source: this.source_,\r\n      style: this.style_,\r\n      name: 'capatopo',\r\n    });\r\n    this.sourceProfile_ = new ol.source.Vector();\r\n    this.vectorProfile_ = new ol.layer.Vector({\r\n      source: this.sourceProfile_,\r\n    });\r\n    this.vector_.setZIndex(100000);\r\n    this.facadeMap_.getMapImpl().addLayer(this.vector_);\r\n    this.projectionMap_ = this.facadeMap_.getProjection().code;\r\n\r\n\r\n  }\r\n\r\n  findNewPoints(originPoint, destPoint) {\r\n    let addX, addY;\r\n    let points = new String();\r\n    let oriMete = ol.proj.transform(originPoint, this.projectionMap_, this.mercator_);\r\n    let destMete = ol.proj.transform(destPoint, this.projectionMap_, this.mercator_);\r\n    let angle = this.getAngleBetweenPoints(oriMete, destMete);\r\n    let distance = this.getDistBetweenPoints(originPoint, destPoint);\r\n    if (distance < 50) {\r\n      points += (ol.proj.transform(oriMete, this.mercator_, this.coordEPSG4326)).slice(0,2) + \",\";\r\n      points += (ol.proj.transform(destMete, this.mercator_, this.coordEPSG4326)).slice(0,2) + \"|\";\r\n      return points;\r\n    }\r\n    let distPoint = (distance / this.distancePoinst_ > this.distancePoinst_) ? distance / this.distancePoinst_ : this.distancePoinst_;\r\n    for (let i = 0; i <= distance / distPoint; i++) {\r\n      if (angle >= 0 && angle <= 90) {\r\n        [addX, addY] = [1, 1];\r\n      } else if (angle >= 90) {\r\n        [addX, addY] = [-1, 1];\r\n      } else if (angle <= 0 && angle >= -90) {\r\n        [addX, addY] = [1, -1];\r\n      } else {\r\n        [addX, addY] = [-1, -1];\r\n      }\r\n      let newPointA = [(Math.cos(angle * Math.PI / 180) * (distPoint * i)) + oriMete[0], (Math.sin(angle * Math.PI / 180) * (distPoint * i)) + oriMete[1]];\r\n      let newPointB = [(Math.cos(angle * Math.PI / 180) * ((distPoint * i) + addX)) + oriMete[0], (Math.sin(angle * Math.PI / 180) * ((distPoint * i) + addY)) + oriMete[1]];\r\n      points += (ol.proj.transform(newPointA, this.mercator_, this.coordEPSG4326)) + \",\";\r\n      points += (ol.proj.transform(newPointB, this.mercator_, this.coordEPSG4326)) + \"|\";\r\n    }\r\n\r\n    return points;\r\n  }\r\n\r\n\r\n  getDistBetweenPoints(firstPoint, secondPoint) {\r\n    let line = new ol.geom.LineString([ol.proj.transform(firstPoint, this.projectionMap_, this.mercator_), ol.proj.transform(secondPoint, this.projectionMap_, this.mercator_)]);\r\n    return line.getLength();\r\n\r\n  }\r\n\r\n  getAngleBetweenPoints(firstPoint, secondPoint) {\r\n    let p1 = {\r\n      x: firstPoint[0],\r\n      y: firstPoint[1]\r\n    };\r\n    let p2 = {\r\n      x: secondPoint[0],\r\n      y: secondPoint[1]\r\n    };\r\n    // angle in degrees\r\n    let angleDeg = Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI;\r\n    return angleDeg;\r\n  }\r\n\r\n  /*startLoad() {\r\n    document.body.style.cursor = 'wait';\r\n    this.deactivate();\r\n    let panel = document.querySelector(\".m-topographicprofile.activated\");\r\n    panel.style.pointerEvents = \"none\";\r\n\r\n  }\r\n\r\n\r\n  endLoad() {\r\n    document.body.style.cursor = 'default';\r\n    this.activate();\r\n    let panel = document.querySelector(\".m-topographicprofile.activated\");\r\n    panel.style.pointerEvents = \"auto\";\r\n  }*/\r\n\r\n  // FBMA\r\n  activate() {\r\n    if(this.mode_ == 'interactive') {\r\n      if (!this.draw_) {\r\n        this.createIteraction(\"LineString\");\r\n        }\r\n        this.facadeMap_.getMapImpl().addInteraction(this.draw_);\r\n    } else {\r\n      // Si aun no hemos cargado la primera vez\r\n      if(!this.lineCoord_) {\r\n        this.createIteraction(\"LineString\");\r\n      } \r\n    }\r\n    document.querySelector('#m-topographicprofile-btn').classList.add('activated');\r\n  }\r\n\r\n  createIteraction(typeGeom) {\r\n    if(this.mode_ == 'interactive') {\r\n      this.draw_ = new ol.interaction.Draw({\r\n      source: this.source_,\r\n      type: /** @type {ol.geom.GeometryType} */ (typeGeom)\r\n      });\r\n      this.draw_.on('drawstart', function(evt) {\r\n        this.projectionMap_ = this.facadeMap_.getProjection().code;\r\n        this.clearLayer();\r\n      }.bind(this));\r\n      this.draw_.on('drawend', function(evt) {\r\n        this.lineCoord_ = evt.feature.getGeometry().getCoordinates();\r\n        this.pointsCoord_ = new String();\r\n        for (let i = 1; i < this.lineCoord_.length; i++) {\r\n          this.pointsCoord_ = this.pointsCoord_.concat(this.findNewPoints(this.lineCoord_[i - 1], this.lineCoord_[i]));\r\n        }\r\n        this.getDataFromService();\r\n      }.bind(this));\r\n    } else {\r\n      this.pointsCoord_ = new String();\r\n      this.lineCoord_ = this.layer_.getFeatures()[0].getGeometry().coordinates;\r\n      if(this.layer_.getFeatures()[0].getGeometry().type == 'MultiLineString') {\r\n        this.lineCoord_ = this.lineCoord_[0];\r\n      }\r\n      // Si las coordenadas incluyen altura y no se fuerza el WS\r\n      if((this.lineCoord_[0].length == 3) && !this.forcews) {\r\n        const arrayXZY = [];\r\n        this.lineCoord_.forEach((coord) => {\r\n          arrayXZY.push(coord);\r\n        });\r\n        this.controlProfile();\r\n        this.lineString_.setCoordinates(arrayXZY);\r\n      } else {\r\n        for (let i = 1; i < this.lineCoord_.length; i++) {\r\n          this.pointsCoord_ = this.pointsCoord_.concat(this.findNewPoints(this.lineCoord_[i - 1], this.lineCoord_[i]));\r\n        }\r\n        this.getDataFromService();\r\n      }\r\n    }\r\n  }\r\n\r\n  getDataFromService() {\r\n    document.body.style.cursor = 'wait';\r\n    if (!this.pointsCoord_) return;\r\n    let pointsBbox = this.pointsCoord_.split('|');\r\n    const altitudes = [];\r\n    const promises = [];\r\n    pointsBbox = pointsBbox.filter((elem) => {\r\n      return elem !== '' && elem.trim().length > 3;\r\n    });\r\n\r\n    pointsBbox.forEach((bbox) => {\r\n      const url = `${PROFILE_URL}${bbox}${PROFILE_URL_SUFFIX}`;\r\n      promises.push(M.remote.get(url));\r\n    });\r\n\r\n    Promise.all(promises).then((responses) => {\r\n      responses.forEach((response) => {\r\n        // TODO: diferencia dy / cellsize?\r\n        if(response.text.split('dy')[1]) {\r\n        const alt = response.text.split('dy')[1].split(' ').filter((item) => {\r\n          return item !== '';\r\n        })[1];\r\n        altitudes.push(parseFloat(alt));\r\n       } else if(response.text.split('cellsize')[1]) {\r\n        const alt = response.text.split('cellsize')[1].split(' ').filter((item) => {\r\n          return item !== '';\r\n        })[1];\r\n        altitudes.push(parseFloat(alt));\r\n      } \r\n      });\r\n\r\n      const arrayXZY = [];\r\n      altitudes.forEach((data, index) => {\r\n        const points = pointsBbox[index].split(',');\r\n        const center = ol.extent.getCenter([parseFloat(points[0]), parseFloat(points[1]),\r\n          parseFloat(points[2]), parseFloat(points[3])\r\n        ]);\r\n        arrayXZY.push([center[0], center[1], data]);\r\n      });\r\n      document.body.style.cursor = 'auto';\r\n      this.controlProfile();\r\n\r\n      const arrayXZY2 = arrayXZY.map((coord) => {\r\n        return ol.proj.transform(coord, 'EPSG:4326', this.facadeMap_.getProjection().code);\r\n      });\r\n\r\n      this.lineString_.setCoordinates(arrayXZY2);\r\n    }).catch((error) => {\r\n      console.log('ERROR', error);\r\n      M.dialog.error('No se han obtenido datos');\r\n      document.body.style.cursor = 'auto';\r\n    });\r\n    // this.deactivate();\r\n  }\r\n\r\n\r\n  controlProfile() {\r\n    if (!this.profil_) {\r\n      this.lineString_ = new ol.geom.LineString([]);\r\n      this.feature_ = new ol.Feature({\r\n        geometry: this.lineString_,\r\n        name: 'Line'\r\n      });\r\n      this.sourceProfile_.addFeature(this.feature_);\r\n      this.profil_ = new Profil({\r\n        info: {\r\n          zmin: getValue('profil.zmin'),\r\n          zmax: getValue('profil.zmax'),\r\n          altitude: getValue('profil.altitude'),\r\n          distance: getValue('profil.distance'),\r\n          ytitle: getValue('profil.ytitle'),\r\n          xtitle: getValue('profil.xtitle'),\r\n          altitudeUnits: 'm',\r\n          \"distanceUnitsM\": 'm',\r\n          'distanceUnitsKM': 'km'\r\n        },\r\n        projection: this.facadeMap_.getProjection().code,\r\n        map: this.facadeMap_.getMapImpl(),\r\n        source: this.source_\r\n      });\r\n      this.facadeMap_.getMapImpl().addControl(this.profil_);\r\n      let drawPoint = function(e) {\r\n        if (!this.pt) return;\r\n        if (e.type == \"over\") { // Show point at coord\r\n          this.pt.setGeometry(new ol.geom.Point(e.coord));\r\n          //this.pt.setStyle(null);\r\n          // icono\r\n          let style = new ol.style.Style({\r\n            image: new ol.style.Icon({\r\n            anchor: [0.5, 32],\r\n            anchorXUnits: 'fraction',\r\n            anchorYUnits: 'pixels',\r\n            src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAANbY1E9YMgAABPBJREFUWIWtl3tMW1Ucxw+0hfEorwIDhdFSKJRnaSnl0ZZXKa9CC4wCo1RhPESWuUQTFd2cuKiJ07hItrnBmFFnXOaymZllWZwic1uMYzGZyZZgMrc/xCnExCjh1Z+/c90qwr0Tj5J8cnO59/zO9/7O9/x+pwQACB8/dzjIrLuB3G6zkfM1xeSdEgN5WZ8lcicrDIkhwYM+Pj4jhJCjxIeMKEKCdzoT4wtfM2SLjxTnkbPVZvI9jqPjaRyhOSiCD+4LuIOBvqwvJ7u06TmxQYHnxL6+SzmR4dCZkgg7MlTQhVddVASIRaLl2KCAC89q1IZxWykn/H8RMOt2kGc06kfwa+cbFHHwTaMVPD1OgMe2ePH0tMC3TVXQqkzAiGTpiQxV/8y98f9JwHzXZrI3X9OJQeGIOQ+gHyfsawXPVicsbW32sozQ/9PnH5QVAC4PvJSbOUDHMwv4wVVPzlSacnHyhaMlBoCBdm6ipQfACRlwwXFLIc2E54Sl0DSNcZgEXG2wkmxZ2LlGTDv0//PkK4HH28GtUoAqVDrxld0iZhLwqj7LJPL1hWtNlQC9reuenBPQ2wI3W2pBIvKFndq0SiYBmsjw5zNl4Vyw1V9/qb4cHkX3ywIDuCu95/OEIToSkkOlQ0wC8O+wE11NjbX6C+mkYrHYC71fkwUc15WaSAONsAoY605V8gqgX75SAL3nE7AjK4UGGmMVcLBBEc/tc9YMuFRyGugQkwBTbNRTyWFSWO52snkAvZOFHtJGRTzHJGC4SKfFgjI/XleOhmr7d7sADfh1g5UWJM/e/Gwjk4CLdWXEGBN1zBQThcvQBp5u57omX+7+M/1V8bG0R5wet5WxFaLpdjvB1Cr9RaLZodwMLuh6ihEtWq/nawBryK+f2UrT7mIcJgEzXC9opm3Ygkaa21eo5d0Rq403WpxHjbd4wKirW8BeMMPaC+hAygKKOGTSN9GGdKbKzC0H/7q3wQSakTYizEDn/UbE3oza673MdW4m29KTd8s2+MN0hwMA2+/fJkd//N7VDMqQYGhPShimon9yOchdl52DScCtVpuX22115M6WOlFKWMjl9iT5mtpAU48HFgj39/vuelNV6K3WWjLVUuOFScAkdsOV3GiupktRRpdisvGvBgV4OPkRsxKIBWm3LqNryllDruH7K2EScKG2ZA1X7BaikYV/4lRu8maBfv0redkQ4e93E7eu/2V8hx7hVsJcB1Zz1VFB3izIqcCtCbgknBcWcd8rpEHQp1Y+OdloJV/ge6thEnDaalzDx8gpq1Ei9ZNM4XJwp59Ldgvd83OnrEUJVxzl5GJ92RqYBBwvL+AFj2mk9KHot2ilg+1uPHCkg1waNEGX6GyVmRcmAaNmPS/vlRrI9gxVdVTABlhEDxRsjAS7/OHBkxVF+CyfFyYBh016XkbNeeSN/JzYQIn4t89tpbARO+KgJs34Pk40hj9K+GAS8KIug5ehe2BRuvG0Rg14/WVfgVZGhQmJZhLwgjZdkD25mSQxRPqpPloGm4KDrr+Np/eDRh05IACTgF61UhAsywQPmx8GSSSQFCo9jz9CCJpRECYBPalKQQbSkkmWLGw/rYrykOCPXMly0qLcJAiTgP2YOiGosezyuF1UQEVczPAxNKDQrqEwCaCuFuKkpYj0qZPcVECHSr7tREUheRe3pxAPEvAHoSjT1B9h9DoAAAAASUVORK5CYII='\r\n              })\r\n            });\r\n          this.pt.setStyle(style);\r\n          // fin icono\r\n        } else { // hide point\r\n          this.pt.setStyle([]);\r\n        }\r\n      }.bind(this);\r\n      this.sourceProfile_.once('change', function(e) {\r\n        if (this.sourceProfile_.getState() === 'ready') {\r\n          this.profil_.setGeometry(this.sourceProfile_.getFeatures()[0]);\r\n          this.pt = new ol.Feature(new ol.geom.Point([0, 0]));\r\n          this.pt.setStyle([]);\r\n          this.source_.addFeature(this.pt);\r\n        }\r\n      }.bind(this));\r\n\r\n      this.profil_.on([\"over\", \"out\"], function(e) {\r\n        if (e.type == \"over\") this.profil_.popup(e.coord[2] + \" m\");\r\n        drawPoint(e);\r\n      }.bind(this));\r\n\r\n    }\r\n    this.profil_.show();\r\n  }\r\n\r\n  deactivate() {\r\n    // Si es interactivo se elimina todo\r\n    if (this.draw_) {\r\n      this.facadeMap_.getMapImpl().removeInteraction(this.draw_);\r\n    } else {\r\n      this.lineCoord_ = null;\r\n    }\r\n    this.clearLayer();\r\n    document.querySelector('#m-topographicprofile-btn').classList.remove('activated');\r\n    \r\n  }\r\n\r\n  clearLayer() {\r\n    this.source_.clear();\r\n    if (this.profil_) {\r\n      this.profil_.hide();\r\n      this.sourceProfile_.clear();\r\n      this.facadeMap_.getMapImpl().removeControl(this.profil_);\r\n      this.profil_ = null;\r\n    }\r\n  }\r\n\r\n  removeLayer() {\r\n    this.deactivate();\r\n    this.clearLayer();\r\n    this.facadeMap_.getMapImpl().removeLayer(this.vector_);\r\n  }\r\n\r\n  destroy() {\r\n    this.removeLayer();\r\n    this.facadeMap_.getMapImpl().removeControl(this);\r\n  }\r\n\r\n  toggle() {\r\n    if (this.profil_) {\r\n      this.profil_.toggle();\r\n    }\r\n  }\r\n\r\n\r\n}\r\n","/**\r\n * @module M/control/Topographicprofilecontrol\r\n */\r\n\r\nimport TopographicprofileImplControl from 'impl/topographicprofilecontrol';\r\nimport template from 'templates/perfiltopografico';\r\nimport { getValue } from './i18n/language';\r\n\r\nexport default class TopographicprofileControl extends M.Control {\r\n  /**\r\n   * @classdesc\r\n   * Main constructor of the class. Creates a PluginControl\r\n   * control\r\n   *\r\n   * @constructor\r\n   * @extends {M.Control}\r\n   * @api stable\r\n   */\r\n  constructor(opts) {\r\n\r\n    // 1. checks if the implementation can create PluginControl\r\n    if (M.utils.isUndefined(TopographicprofileImplControl)) {\r\n      M.exception('La implementación usada no puede crear controles TopographicprofileControl');\r\n    }\r\n    // 2. implementation of this control\r\n    const impl = new TopographicprofileImplControl(opts);\r\n    super(impl, 'Topographicprofile');\r\n\r\n    [this.btnData_, this.btnRemove_, this.facadeMap_, this.html_, this.drawCtrl_, this.opts] = [null, null, null, null, null, impl, opts];\r\n  }\r\n\r\n  /**\r\n   * This function creates the view\r\n   *\r\n   * @public\r\n   * @function\r\n   * @param {M.Map} map to add the control\r\n   * @api stable\r\n   */\r\n  createView(map) {\r\n    if (!M.template.compileSync) { // JGL: retrocompatibilidad Mapea4\r\n      M.template.compileSync = (string, options) => {\r\n        let templateCompiled;\r\n        let templateVars = {};\r\n        let parseToHtml;\r\n        if (!M.utils.isUndefined(options)) {\r\n          templateVars = M.utils.extends(templateVars, options.vars);\r\n          parseToHtml = options.parseToHtml;\r\n        }\r\n        const templateFn = Handlebars.compile(string);\r\n        const htmlText = templateFn(templateVars);\r\n        if (parseToHtml !== false) {\r\n          templateCompiled = M.utils.stringToHtml(htmlText);\r\n        } else {\r\n          templateCompiled = htmlText;\r\n        }\r\n        return templateCompiled;\r\n      };\r\n    }\r\n    this.facadeMap_ = map;\r\n\r\n    return new Promise((success, fail) => {\r\n      const html = M.template.compileSync(template);\r\n      // Añadir código dependiente del DOM\r\n      this.template_ = html;\r\n      html.querySelector('#m-topographicprofile-btn').title = getValue('title');\r\n      success(html);\r\n    });\r\n  }\r\n  /**\r\n   * This function gets activation button\r\n   *\r\n   * @public\r\n   * @function\r\n   * @param {HTML} html of control\r\n   * @api stable\r\n   */\r\n\r\n  getActivationButton(html) {\r\n    return html.querySelector('#m-topographicprofile-btn');\r\n  }\r\n\r\n\r\n  /**\r\n   * This function is called on the control deactivation\r\n   *\r\n   * @public\r\n   * @function\r\n   * @api stable\r\n   */\r\n  deactivate() {\r\n    super.deactivate();\r\n  }\r\n\r\n  /**\r\n   * This function compares controls\r\n   *\r\n   * @public\r\n   * @function\r\n   * @param {M.Control} control to compare\r\n   * @api stable\r\n   */\r\n  equals(control) {\r\n    return control instanceof TopographicprofileControl;\r\n  }\r\n}\r\n","/**\r\n * @module M/plugin/Topographicprofile\r\n */\r\nimport 'assets/css/topographicprofile';\r\nimport TopographicprofileControl from './topographicprofilecontrol';\r\nimport api from '../../api';\r\nimport { getValue } from './i18n/language';\r\n\r\nexport default class Topographicprofile extends M.Plugin {\r\n  /**\r\n   * @classdesc\r\n   * Main facade plugin object. This class creates a plugin\r\n   * object which has an implementation Object\r\n   *\r\n   * @constructor\r\n   * @extends {M.Plugin}\r\n   * @param {Object} impl implementation object\r\n   * @api stable\r\n   */\r\n  constructor(opts = {}) {\r\n    super();\r\n    /**\r\n     * Facade of the map\r\n     * @private\r\n     * @type {M.Map}\r\n     */\r\n    this.map_ = null;\r\n\r\n    /**\r\n     * Array of controls\r\n     * @private\r\n     * @type {Array<M.Control>}\r\n     */\r\n    this.controls_ = [];\r\n\r\n    /**\r\n     * Position\r\n     * @private\r\n     * @type {Array<M.Control>}\r\n     */\r\n    this.position_ = opts.position ? opts.position : 'TR';\r\n\r\n\r\n    /**\r\n     * Metadata from api.json\r\n     * @private\r\n     * @type {Object}\r\n     */\r\n    this.metadata_ = api.metadata;\r\n    this.facadeMap_ = null;\r\n    this.panel_ = null;\r\n    this.control_ = null;\r\n    this.options_ = opts;\r\n    this.layer_ = opts.layer;\r\n    this.mode_ =(opts.mode? opts.mode : 'interactive');\r\n  }\r\n\r\n  /**\r\n   * This function adds this plugin into the map\r\n   *\r\n   * @public\r\n   * @function\r\n   * @param {M.Map} map the map to add the plugin\r\n   * @api stable\r\n   */\r\n  addTo(map) {\r\n    this.controls_.push(new TopographicprofileControl(this.options_));\r\n    this.map_ = map;\r\n    // panel para agregar control - no obligatorio\r\n    this.panel_ = new M.ui.Panel('panelTopographicprofile', {\r\n      // 'collapsible': true,\r\n      'className': 'm-topographicprofile',\r\n      'collapsedButtonClass': 'icon-chart',\r\n      'position': M.ui.position[this.position_],\r\n      'tooltip': getValue('tooltip')\r\n    });\r\n    this.panel_.addControls(this.controls_);\r\n    this.panel_.on(M.evt.ADDED_TO_MAP, () => {\r\n      this.fire(M.evt.ADDED_TO_MAP);\r\n    });\r\n    map.addPanels(this.panel_);\r\n  }\r\n\r\n\r\n  /**\r\n   * This function gets metadata plugin\r\n   *\r\n   * @public\r\n   * @function\r\n   * @api stable\r\n   */\r\n  getMetadata() {\r\n    return this.metadata_;\r\n  }\r\n\r\n  /**\r\n   * Get the API REST Parameters of the plugin\r\n   *\r\n   * @function\r\n   * @public\r\n   * @api\r\n   */\r\n  getAPIRest() {\r\n    return `${this.name}=${this.position_}`\r\n  }\r\n\r\n  /**\r\n   * This function destroys this plugin\r\n   *\r\n   * @public\r\n   * @function\r\n   * @api stable\r\n   */\r\n  destroy() {\r\n    this.map_.removeControls(this.controls_);\r\n    [this.map_, this.controls_, this.panel_] = [null, null, null];\r\n  }\r\n\r\n  get name() {\r\n    return \"topographicprofile\";\r\n  }\r\n}\r\n","import M$plugin$Topographicprofile from '/home/fbmanas/Codigo/git-sigc/topographicprofile/src/facade/js/topographicprofile';\nimport M$control$Topographicprofilecontrol from '/home/fbmanas/Codigo/git-sigc/topographicprofile/src/facade/js/topographicprofilecontrol';\nimport M$impl$control$TopographicprofileControl from '/home/fbmanas/Codigo/git-sigc/topographicprofile/src/impl/ol/js/topographicprofilecontrol';\n\nif (!window.M.plugin) window.M.plugin = {};\nif (!window.M.control) window.M.control = {};\nif (!window.M.impl) window.M.impl = {};\nif (!window.M.impl.control) window.M.impl.control = {};\nwindow.M.plugin.Topographicprofile = M$plugin$Topographicprofile;\nwindow.M.control.Topographicprofilecontrol = M$control$Topographicprofilecontrol;\nwindow.M.impl.control.TopographicprofileControl = M$impl$control$TopographicprofileControl;\n"],"sourceRoot":""}