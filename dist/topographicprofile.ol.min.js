!function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=5)}([function(t){t.exports=JSON.parse('{"exception":{"impl":"The implementation used cannot create Perfiltopografico controls."},"tooltip":"Topography Profile","title":"Topography Profile","profil":{"title":"Topographic Profile","zmin":"Min Alt.","zmax":"Max Alt.","altitude":"Alt.","distance":"Full Distance","ytitle":"Altitude (m)","xtitle":"Distance (km)"}}')},function(t){t.exports=JSON.parse('{"exception":{"impl":"La implementación no puede crear controles de Perfiltopografico."},"tooltip":"Perfil Topográfico","title":"Perfil Topográfico","profil":{"title":"Perfil Topográfico","zmin":"Alt. min","zmax":"Alt. max","altitude":"Altitud","distance":"Dist. total","ytitle":"Altitud (m)","xtitle":"Distancia (km)"}}')},function(t,e){t.exports='<div class="m-control m-container m-topographicprofile-container">\r\n    <button id=\'m-topographicprofile-btn\' class="m-topographicprofile-btn icon-chart"></button>\r\n</div>\r\n'},function(t){t.exports=JSON.parse('{"url":{"name":"topographicprofile","separator":"*"},"constructor":"M.plugin.Topographicprofile","parameters":[{"type":"object","properties":[{"type":"simple","name":"mode","possibleValues":["interactive","fixed"],"position":0},{"type":"boolean","name":"forcews","position":1},{"type":"simple","name":"layer","position":2}]}],"files":{"ol":{"scripts":["topographicprofile.ol.min.js"],"styles":["topographicprofile.ol.min.css"]}},"metadata":{"name":"Perfil Topográfico","description":"Genera un perfil longitudinal","text":"Muestra un perfil longitudinal del terreno a partir de un dibujado, o desde las coordnadas de la capa si tienen altura","version":"2.0.0","date":"Marzo, 2023","author":"","org":"ADA. Junta de Andalucía.","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true,"compatibility":["6"]}}')},function(t,e,o){},function(t,e,o){"use strict";o.r(e);o(4);var n={en:o(0),es:o(1)},r=function(){var t="es";return"function"==typeof M.language.getLang&&(t=M.language.getLang()),t},i=function(t){return n[t]},a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r(),o=i(e),n="";return M.utils.isNullOrEmpty(o)?console.warn("The translation '".concat(e,"' has not been defined.")):n=t.split(".").reduce((function(t,e){return t[e]}),o),n};function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(r=n.key,i=void 0,i=function(t,e){if("object"!==l(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===l(i)?i:String(i)),n)}var r,i}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,n=d(t);if(e){var r=d(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return p(this,o)}}function p(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h={zmin:"Zmin",zmax:"Zmax",ytitle:"Altitude (m)",xtitle:"Distance (km)",time:"Time",altitude:"Altitude",distance:"Distance",altitudeUnits:"m",distanceUnitsM:"m",distanceUnitsKM:"km"},m=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(i,ol.control.Control);var e,o,n,r=u(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var o,n=t||{};if(n.target)(o=document.createElement("div")).classList.add(n.className||"ol-profil");else{(o=document.createElement("div")).className=((n.className||"ol-profil")+" ol-unselectable ol-control ol-collapsed").trim();var l=document.createElement("p");l.textContent=a("profil.title"),o.appendChild(l);var s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("class","profile-close-button");var c=function(o){t.map.removeControl(f(e)),n.source.clear()};s.addEventListener("click",c),s.addEventListener("touchstart",c),l.appendChild(s);var u=document.createElement("button");u.setAttribute("type","button"),u.setAttribute("class","profile-download-button");var p=function(t){var o=e.getImage(),n=document.createElement("a");n.href=o,n.download="Perfil.png",n.click(),n.remove()};u.addEventListener("click",p),u.addEventListener("touchstart",p),l.appendChild(u)}var d=document.createElement("div");d.classList.add("ol-inner"),o.appendChild(d);var m=document.createElement("div");m.style.position="relative",d.appendChild(m),(e=r.call(this,{element:o,target:n.target})).info=n.info||h;var y=f(e),v=e.ratio=2;e.canvas_=document.createElement("canvas"),e.canvas_.width=(n.width||300)*v,e.canvas_.height=(n.height||150)*v;var g={msTransform:"scale(0.5,0.5)",msTransformOrigin:"0 0",webkitTransform:"scale(0.5,0.5)",webkitTransformOrigin:"0 0",mozTransform:"scale(0.5,0.5)",mozTransformOrigin:"0 0",transform:"scale(0.5,0.5)",transformOrigin:"0 0"};Object.keys(g).forEach((function(t){t in y.canvas_.style&&(y.canvas_.style[t]=g[t])}));var _=document.createElement("div");m.appendChild(_),_.style.width=e.canvas_.width/v+"px",_.style.height=e.canvas_.height/v+"px",_.appendChild(e.canvas_),_.addEventListener("click",(function(t){y.onMove(t)})),_.addEventListener("mousemove",(function(t){y.onMove(t)})),e.margin_={top:10*v,left:40*v,bottom:30*v,right:10*v},e.info.ytitle||(e.margin_.left-=20*v),e.info.xtitle||(e.margin_.bottom-=20*v),e.bar_=document.createElement("div"),e.bar_.classList.add("ol-profilbar"),e.bar_.style.top=e.margin_.top/v+"px",e.bar_.style.height=(e.canvas_.height-e.margin_.top-e.margin_.bottom)/v+"px",m.appendChild(e.bar_),e.cursor_=document.createElement("div"),e.cursor_.classList.add("ol-profilcursor"),m.appendChild(e.cursor_),e.popup_=document.createElement("div"),e.popup_.classList.add("ol-profilpopup"),e.cursor_.appendChild(e.popup_);var b=document.createElement("table");b.cellPadding="0",b.cellSpacing="0",b.style.clientWidth=e.canvas_.width/v+"px",m.appendChild(b);var w=document.createElement("tr");w.classList.add("track-info"),b.appendChild(w);var M=document.createElement("td");M.innerHTML=(e.info.zmin||"Zmin")+': <span class="zmin">',w.appendChild(M);var P=document.createElement("td");P.innerHTML=(e.info.zmax||"Zmax")+': <span class="zmax">',w.appendChild(P);var S=document.createElement("td");S.innerHTML=(e.info.distance||"Distance")+': <span class="dist">',w.appendChild(S);var C=document.createElement("tr");C.classList.add("point-info"),b.appendChild(C);var O=document.createElement("td");O.innerHTML=(e.info.altitude||"Altitude")+': <span class="z">',C.appendChild(O);var j=document.createElement("td");j.innerHTML='Dist. parcial: <span class="dist">',C.appendChild(j);var E=document.createElement("td");return E.innerHTML=(e.info.time||"Time")+': <span class="time">',C.appendChild(E),e.tab_=[],n.feature&&e.setGeometry(n.feature),e}return e=i,(o=[{key:"popup",value:function(t){this.popup_.innerHTML=t}},{key:"onMove",value:function(t){if(this.tab_.length){var e=this.canvas_.getBoundingClientRect(),o=e.top+window.pageYOffset-document.documentElement.clientTop,n=e.left+window.pageXOffset-document.documentElement.clientLeft,r=t.pageX-n,i=t.pageY-o,a=this.ratio;if(r>this.margin_.left/a&&r<(this.canvas_.width-this.margin_.right)/a&&i>this.margin_.top/a&&i<(this.canvas_.height-this.margin_.bottom)/a){this.bar_.style.left=r+"px",this.bar_.style.display="block";for(var l,s=(r*a-this.margin_.left)/this.scale_[0],c=this.tab_[0],u=1;l=this.tab_[u];u++)if(l[0]>=s){s<(l[0]+c[0])/2&&(l=c);break}l?(this.cursor_.style.left=r+"px",this.cursor_.style.top=(this.canvas_.height-this.margin_.bottom+l[1]*this.scale_[1]+this.dy_)/a+"px",this.cursor_.style.display="block"):this.cursor_.style.display="none",this.bar_.parentElement.classList.add("over"),this.element.querySelector(".point-info .z").textContent=l[1]+this.info.altitudeUnits,this.element.querySelector(".point-info .dist").textContent=(l[0]/1e3).toFixed(1)+this.info.distanceUnitsKM,this.element.querySelector(".point-info .time").textContent=l[2],r>this.canvas_.width/a/2?this.popup_.classList.add("ol-left"):this.popup_.classList.remove("ol-left"),this.dispatchEvent({type:"over",click:"click"==t.type,coord:l[3],time:l[2],distance:l[0]})}else this.bar_.parentElement.classList.contains("over")&&(this.bar_.style.display="none",this.cursor_.style.display="none",this.bar_.parentElement.classList.remove("over"),this.dispatchEvent({type:"out"}))}}},{key:"show",value:function(){this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"show",show:!0})}},{key:"hide",value:function(){this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"show",show:!1})}},{key:"toggle",value:function(){this.element.classList.toggle("ol-collapsed");var t=this.element.classList.contains("ol-collapsed");this.dispatchEvent({type:"show",show:!t})}},{key:"isShown",value:function(){return!this.element.classList.contains("ol-collapsed")}},{key:"setGeometry",value:function(t,e){e||(e={}),t instanceof ol.Feature&&(t=t.getGeometry());var o=this.canvas_,n=o.getContext("2d"),r=o.width,i=o.height;if(n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,r,i),/Z/.test(t.getLayout())){/M/.test(t.getLayout())?this.element.querySelector(".time").parentElement.style.display="block":this.element.querySelector(".time").parentElement.style.display="none";var a=t.getCoordinates();switch(t.getType()){case"LineString":break;case"MultiLineString":a=a[0];break;default:return}var l=e.projection||this.getMap().getView().getProjection();n.setTransform(1,0,0,1,this.margin_.left,i-this.margin_.bottom);var s=this.ratio;r-=this.margin_.right+this.margin_.left,i-=this.margin_.top+this.margin_.bottom,n.strokeStyle="#000",n.lineWidth=.5*s,n.beginPath(),n.moveTo(0,0),n.lineTo(0,-i),n.moveTo(0,0),n.lineTo(r,0),n.stroke();var c,u,p,f,d,h,m,y=1/0,v=-1/0,g=this.tab_=[];for(c=0;u=a[c];c++)(f=u[2])<y&&(y=f),f>v&&(v=f),0==c?p=0:p+=(h=a[c-1],m=u,ol.sphere.getDistance(ol.proj.transform(h,l,"EPSG:4326"),ol.proj.transform(m,l,"EPSG:4326"))),d=j(a[0][3],u[3]),g.push([p,f,d,u]);this.element.querySelector(".track-info .zmin").textContent=y.toFixed(2)+this.info.altitudeUnits,this.element.querySelector(".track-info .zmax").textContent=v.toFixed(2)+this.info.altitudeUnits,this.element.querySelector(".track-info .dist").textContent=p>1e3?(p/1e3).toFixed(1)+this.info.distanceUnitsKM:p.toFixed(1)+this.info.distanceUnitsM;for(var _=e.graduation||100;i/(((v=Math.ceil(v/_)*_)-(y=Math.floor(y/_)*_))/_)<15*s;)_*=2;"number"==typeof e.zmin&&y>e.zmin&&(y=e.zmin),"number"==typeof e.zmax&&v<e.zmax&&(v=e.zmax);var b=e.amplitude;b&&(v=Math.max(y+b,v));var w=r/p,M=-i/(v-y),P=this.dy_=-y*M;for(this.scale_=[w,M],n.font=10*s+"px arial",n.textAlign="right",n.textBaseline="middle",n.fillStyle="#000",n.beginPath(),c=y;c<=v;c+=_)"km"!=e.zunit?n.fillText(c,-4*s,c*M+P):n.fillText((c/1e3).toFixed(1),-4*s,c*M+P),n.moveTo(-2*s,c*M+P),0!=c?n.lineTo(p*w,c*M+P):n.lineTo(0,c*M+P);n.textAlign="center",n.textBaseline="top",n.setLineDash([s,3*s]);var S,C=e.unit||"km";for(p>1e3?(S=100*Math.round(p/1e3))>1e3&&(S=1e3*Math.ceil(S/1e3)):(C="m",S=p>100?10*Math.round(p/100):p>10?Math.round(p/10):p>1?Math.round(p)/10:p),c=0;c<=p;c+=S){var O="m"==C?c:c/1e3;n.fillText(Math.round(10*O)/10,c*w,4*s),n.moveTo(c*w,2*s),n.lineTo(c*w,0)}for(n.font=12*s+"px arial",n.fillText(this.info.xtitle.replace("(km)","("+C+")"),r/2,18*s),n.save(),n.rotate(-Math.PI/2),n.fillText(this.info.ytitle,i/2,-this.margin_.left),n.restore(),n.stroke(),n.strokeStyle="#368",n.lineWidth=3,n.setLineDash([]),n.beginPath(),c=0;u=g[c];c++)0==c?n.moveTo(u[0]*w,u[1]*M+P):n.lineTo(u[0]*w,u[1]*M+P);n.stroke()}function j(t,e){if(!t||!e)return"-";var o=(e-t)/60,n=Math.trunc(o/60),r=Math.trunc(o-60*n);return n+"h"+(r<10?"0":"")+r+"mn"}}},{key:"getImage",value:function(t,e){return"canvas"===t?this.canvas_:this.canvas_.toDataURL(t,e)}}])&&s(e.prototype,o),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(r=n.key,i=void 0,i=function(t,e){if("object"!==y(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===y(i)?i:String(i)),n)}var r,i}function g(){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,o){var n=_(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:o):r.value}}).apply(this,arguments)}function _(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=S(t)););return t}function b(t,e){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,n=S(t);if(e){var r=S(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return P(this,o)}}function P(t,e){if(e&&("object"===y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var C="https://www.juntadeandalucia.es/medioambiente/mapwms/REDIAM_WCS_mdt?request=GetCoverage&bbox=",O="&service=WCS&version=1.0.0&coverage=Modelo%20Digital%20de%20Elevaciones%20(MDE)%20de%20Andalucia%20100%20m&interpolationMethod=bilinear&crs=EPSG%3A4258&format=image%2Fx-aaigrid&width=2&height=2",j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}(i,M.impl.Control);var e,o,n,r=w(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=r.call(this);var o=[30,"EPSG:900913",t.serviceURL,"EPSG:4326"];e.distancePoinst_=o[0],e.mercator_=o[1],e.serviceURL=o[2],e.coordEPSG4326=o[3];var n=[null,null,null,null,null,null,null,null,null,null,null,null];e.projectionMap_=n[0],e.profil_=n[1],e.facadeMap_=n[2],e.vector_=n[3],e.source_=n[4],e.vectorProfile_=n[5],e.sourceProfile_=n[6],e.draw_=n[7],e.lineCoord_=n[8],e.pointsCoord_=n[9],e.dataPoints_=n[10],e.pt=n[11];var a=[null,null,null];return e.lineString_=a[0],e.feature_=a[1],e.style_=a[2],e.layer_=t.layer,e.mode_=t.mode?t.mode:"interactive",e.includesAltitude_=!1,e.forcews=t.forcews,t.wcs&&(C=t.wcs.url+"?request=GetCoverage&bbox=",O="&service=WCS&version="+t.wcs.version+"&coverage="+t.wcs.coverage+"&interpolationMethod="+t.wcs.interpolationMethod+"&crs=EPSG%3A4258&format="+t.wcs.format+"&width=2&height=2"),e}return e=i,(o=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.layer_&&("string"==typeof this.layer_||this.layer_ instanceof String)&&(this.layer_=this.facadeMap_.getLayers({name:this.layer_})[0]),this.initOlLayers(),g(S(i.prototype),"addTo",this).call(this,t,e),"fixed"==this.mode_&&this.activate()}},{key:"initOlLayers",value:function(){this.style_=function(t){return"LineString"==t.getGeometry().getType()?[new ol.style.Style({stroke:new ol.style.Stroke({color:"#4286f4",width:2})})]:[new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#4286f4"})}),stroke:new ol.style.Stroke({color:"#4286f4",width:2}),fill:new ol.style.Fill({color:"#4286f4"})})]},this.source_=new ol.source.Vector({wrapX:!1}),this.vector_=new ol.layer.Vector({source:this.source_,style:this.style_,name:"capatopo"}),this.sourceProfile_=new ol.source.Vector,this.vectorProfile_=new ol.layer.Vector({source:this.sourceProfile_}),this.vector_.setZIndex(1e5),this.facadeMap_.getMapImpl().addLayer(this.vector_),this.projectionMap_=this.facadeMap_.getProjection().code}},{key:"findNewPoints",value:function(t,e){var o,n,r=new String,i=ol.proj.transform(t,this.projectionMap_,this.mercator_),a=ol.proj.transform(e,this.projectionMap_,this.mercator_),l=this.getAngleBetweenPoints(i,a),s=this.getDistBetweenPoints(t,e);if(s<50)return r+=ol.proj.transform(i,this.mercator_,this.coordEPSG4326).slice(0,2)+",",r+=ol.proj.transform(a,this.mercator_,this.coordEPSG4326).slice(0,2)+"|";for(var c=s/this.distancePoinst_>this.distancePoinst_?s/this.distancePoinst_:this.distancePoinst_,u=0;u<=s/c;u++){l>=0&&l<=90?(o=1,n=1):l>=90?(o=-1,n=1):l<=0&&l>=-90?(o=1,n=-1):(o=-1,n=-1);var p=[Math.cos(l*Math.PI/180)*(c*u)+i[0],Math.sin(l*Math.PI/180)*(c*u)+i[1]],f=[Math.cos(l*Math.PI/180)*(c*u+o)+i[0],Math.sin(l*Math.PI/180)*(c*u+n)+i[1]];r+=ol.proj.transform(p,this.mercator_,this.coordEPSG4326)+",",r+=ol.proj.transform(f,this.mercator_,this.coordEPSG4326)+"|"}return r}},{key:"getDistBetweenPoints",value:function(t,e){return new ol.geom.LineString([ol.proj.transform(t,this.projectionMap_,this.mercator_),ol.proj.transform(e,this.projectionMap_,this.mercator_)]).getLength()}},{key:"getAngleBetweenPoints",value:function(t,e){var o=t[0],n=t[1],r=e[0],i=e[1];return 180*Math.atan2(i-n,r-o)/Math.PI}},{key:"activate",value:function(){"interactive"==this.mode_?(this.draw_||this.createIteraction("LineString"),this.facadeMap_.getMapImpl().addInteraction(this.draw_)):this.lineCoord_||this.createIteraction("LineString"),document.querySelector("#m-topographicprofile-btn").classList.add("activated")}},{key:"createIteraction",value:function(t){if("interactive"==this.mode_)this.draw_=new ol.interaction.Draw({source:this.source_,type:t}),this.draw_.on("drawstart",function(t){this.projectionMap_=this.facadeMap_.getProjection().code,this.clearLayer()}.bind(this)),this.draw_.on("drawend",function(t){this.lineCoord_=t.feature.getGeometry().getCoordinates(),this.pointsCoord_=new String;for(var e=1;e<this.lineCoord_.length;e++)this.pointsCoord_=this.pointsCoord_.concat(this.findNewPoints(this.lineCoord_[e-1],this.lineCoord_[e]));this.getDataFromService()}.bind(this));else if(this.pointsCoord_=new String,this.lineCoord_=this.layer_.getFeatures()[0].getGeometry().coordinates,"MultiLineString"==this.layer_.getFeatures()[0].getGeometry().type&&(this.lineCoord_=this.lineCoord_[0]),3!=this.lineCoord_[0].length||this.forcews){for(var e=1;e<this.lineCoord_.length;e++)this.pointsCoord_=this.pointsCoord_.concat(this.findNewPoints(this.lineCoord_[e-1],this.lineCoord_[e]));this.getDataFromService()}else{var o=[];this.lineCoord_.forEach((function(t){o.push(t)})),this.controlProfile(),this.lineString_.setCoordinates(o)}}},{key:"getDataFromService",value:function(){var t=this;if(document.body.style.cursor="wait",this.pointsCoord_){var e=this.pointsCoord_.split("|"),o=[],n=[];(e=e.filter((function(t){return""!==t&&t.trim().length>3}))).forEach((function(t){var e="".concat(C).concat(t).concat(O);n.push(M.remote.get(e))})),Promise.all(n).then((function(n){n.forEach((function(t){if(t.text.split("dy")[1]){var e=t.text.split("dy")[1].split(" ").filter((function(t){return""!==t}))[1];o.push(parseFloat(e))}else if(t.text.split("cellsize")[1]){var n=t.text.split("cellsize")[1].split(" ").filter((function(t){return""!==t}))[1];o.push(parseFloat(n))}}));var r=[];o.forEach((function(t,o){var n=e[o].split(","),i=ol.extent.getCenter([parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])]);r.push([i[0],i[1],t])})),document.body.style.cursor="auto",t.controlProfile();var i=r.map((function(e){return ol.proj.transform(e,"EPSG:4326",t.facadeMap_.getProjection().code)}));t.lineString_.setCoordinates(i)})).catch((function(t){console.log("ERROR",t),M.dialog.error("No se han obtenido datos"),document.body.style.cursor="auto"}))}}},{key:"controlProfile",value:function(){if(!this.profil_){this.lineString_=new ol.geom.LineString([]),this.feature_=new ol.Feature({geometry:this.lineString_,name:"Line"}),this.sourceProfile_.addFeature(this.feature_),this.profil_=new m({info:{zmin:a("profil.zmin"),zmax:a("profil.zmax"),altitude:a("profil.altitude"),distance:a("profil.distance"),ytitle:a("profil.ytitle"),xtitle:a("profil.xtitle"),altitudeUnits:"m",distanceUnitsM:"m",distanceUnitsKM:"km"},projection:this.facadeMap_.getProjection().code,map:this.facadeMap_.getMapImpl(),source:this.source_}),this.facadeMap_.getMapImpl().addControl(this.profil_);var t=function(t){if(this.pt)if("over"==t.type){this.pt.setGeometry(new ol.geom.Point(t.coord));var e=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,32],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAANbY1E9YMgAABPBJREFUWIWtl3tMW1Ucxw+0hfEorwIDhdFSKJRnaSnl0ZZXKa9CC4wCo1RhPESWuUQTFd2cuKiJ07hItrnBmFFnXOaymZllWZwic1uMYzGZyZZgMrc/xCnExCjh1Z+/c90qwr0Tj5J8cnO59/zO9/7O9/x+pwQACB8/dzjIrLuB3G6zkfM1xeSdEgN5WZ8lcicrDIkhwYM+Pj4jhJCjxIeMKEKCdzoT4wtfM2SLjxTnkbPVZvI9jqPjaRyhOSiCD+4LuIOBvqwvJ7u06TmxQYHnxL6+SzmR4dCZkgg7MlTQhVddVASIRaLl2KCAC89q1IZxWykn/H8RMOt2kGc06kfwa+cbFHHwTaMVPD1OgMe2ePH0tMC3TVXQqkzAiGTpiQxV/8y98f9JwHzXZrI3X9OJQeGIOQ+gHyfsawXPVicsbW32sozQ/9PnH5QVAC4PvJSbOUDHMwv4wVVPzlSacnHyhaMlBoCBdm6ipQfACRlwwXFLIc2E54Sl0DSNcZgEXG2wkmxZ2LlGTDv0//PkK4HH28GtUoAqVDrxld0iZhLwqj7LJPL1hWtNlQC9reuenBPQ2wI3W2pBIvKFndq0SiYBmsjw5zNl4Vyw1V9/qb4cHkX3ywIDuCu95/OEIToSkkOlQ0wC8O+wE11NjbX6C+mkYrHYC71fkwUc15WaSAONsAoY605V8gqgX75SAL3nE7AjK4UGGmMVcLBBEc/tc9YMuFRyGugQkwBTbNRTyWFSWO52snkAvZOFHtJGRTzHJGC4SKfFgjI/XleOhmr7d7sADfh1g5UWJM/e/Gwjk4CLdWXEGBN1zBQThcvQBp5u57omX+7+M/1V8bG0R5wet5WxFaLpdjvB1Cr9RaLZodwMLuh6ihEtWq/nawBryK+f2UrT7mIcJgEzXC9opm3Ygkaa21eo5d0Rq403WpxHjbd4wKirW8BeMMPaC+hAygKKOGTSN9GGdKbKzC0H/7q3wQSakTYizEDn/UbE3oza673MdW4m29KTd8s2+MN0hwMA2+/fJkd//N7VDMqQYGhPShimon9yOchdl52DScCtVpuX22115M6WOlFKWMjl9iT5mtpAU48HFgj39/vuelNV6K3WWjLVUuOFScAkdsOV3GiupktRRpdisvGvBgV4OPkRsxKIBWm3LqNryllDruH7K2EScKG2ZA1X7BaikYV/4lRu8maBfv0redkQ4e93E7eu/2V8hx7hVsJcB1Zz1VFB3izIqcCtCbgknBcWcd8rpEHQp1Y+OdloJV/ge6thEnDaalzDx8gpq1Ei9ZNM4XJwp59Ldgvd83OnrEUJVxzl5GJ92RqYBBwvL+AFj2mk9KHot2ilg+1uPHCkg1waNEGX6GyVmRcmAaNmPS/vlRrI9gxVdVTABlhEDxRsjAS7/OHBkxVF+CyfFyYBh016XkbNeeSN/JzYQIn4t89tpbARO+KgJs34Pk40hj9K+GAS8KIug5ehe2BRuvG0Rg14/WVfgVZGhQmJZhLwgjZdkD25mSQxRPqpPloGm4KDrr+Np/eDRh05IACTgF61UhAsywQPmx8GSSSQFCo9jz9CCJpRECYBPalKQQbSkkmWLGw/rYrykOCPXMly0qLcJAiTgP2YOiGosezyuF1UQEVczPAxNKDQrqEwCaCuFuKkpYj0qZPcVECHSr7tREUheRe3pxAPEvAHoSjT1B9h9DoAAAAASUVORK5CYII="})});this.pt.setStyle(e)}else this.pt.setStyle([])}.bind(this);this.sourceProfile_.once("change",function(t){"ready"===this.sourceProfile_.getState()&&(this.profil_.setGeometry(this.sourceProfile_.getFeatures()[0]),this.pt=new ol.Feature(new ol.geom.Point([0,0])),this.pt.setStyle([]),this.source_.addFeature(this.pt))}.bind(this)),this.profil_.on(["over","out"],function(e){"over"==e.type&&this.profil_.popup(e.coord[2]+" m"),t(e)}.bind(this))}this.profil_.show()}},{key:"deactivate",value:function(){this.draw_?this.facadeMap_.getMapImpl().removeInteraction(this.draw_):this.lineCoord_=null,this.clearLayer(),document.querySelector("#m-topographicprofile-btn").classList.remove("activated")}},{key:"clearLayer",value:function(){this.source_.clear(),this.profil_&&(this.profil_.hide(),this.sourceProfile_.clear(),this.facadeMap_.getMapImpl().removeControl(this.profil_),this.profil_=null)}},{key:"removeLayer",value:function(){this.deactivate(),this.clearLayer(),this.facadeMap_.getMapImpl().removeLayer(this.vector_)}},{key:"destroy",value:function(){this.removeLayer(),this.facadeMap_.getMapImpl().removeControl(this)}},{key:"toggle",value:function(){this.profil_&&this.profil_.toggle()}}])&&v(e.prototype,o),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(),E=o(2),x=o.n(E);function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function T(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(r=n.key,i=void 0,i=function(t,e){if("object"!==k(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===k(i)?i:String(i)),n)}var r,i}function A(){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,o){var n=L(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:o):r.value}}).apply(this,arguments)}function L(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}function R(t,e){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function G(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,n=D(t);if(e){var r=D(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return z(this,o)}}function z(t,e){if(e&&("object"===k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&R(t,e)}(i,M.Control);var e,o,n,r=G(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),M.utils.isUndefined(j)&&M.exception("La implementación usada no puede crear controles TopographicprofileControl");var o=new j(t),n=[null,null,null,null,null,o,t];return(e=r.call(this,o,"Topographicprofile")).btnData_=n[0],e.btnRemove_=n[1],e.facadeMap_=n[2],e.html_=n[3],e.drawCtrl_=n[4],e.opts=n[5],e}return e=i,(o=[{key:"createView",value:function(t){var e=this;return M.template.compileSync||(M.template.compileSync=function(t,e){var o,n={};M.utils.isUndefined(e)||(n=M.utils.extends(n,e.vars),o=e.parseToHtml);var r=Handlebars.compile(t)(n);return!1!==o?M.utils.stringToHtml(r):r}),this.facadeMap_=t,new Promise((function(t,o){var n=M.template.compileSync(x.a);e.template_=n,n.querySelector("#m-topographicprofile-btn").title=a("title"),t(n)}))}},{key:"getActivationButton",value:function(t){return t.querySelector("#m-topographicprofile-btn")}},{key:"deactivate",value:function(){A(D(i.prototype),"deactivate",this).call(this)}},{key:"equals",value:function(t){return t instanceof i}}])&&T(e.prototype,o),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(),I=o(3);function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(r=n.key,i=void 0,i=function(t,e){if("object"!==F(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!==F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===F(i)?i:String(i)),n)}var r,i}function N(t,e){return(N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,n=K(t);if(e){var r=K(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return H(this,o)}}function H(t,e){if(e&&("object"===F(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}(i,M.Plugin);var e,o,n,r=q(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return V(this,i),(t=r.call(this)).map_=null,t.controls_=[],t.position_=e.position?e.position:"TR",t.metadata_=I.metadata,t.facadeMap_=null,t.panel_=null,t.control_=null,t.options_=e,t.layer_=e.layer,t.mode_=e.mode?e.mode:"interactive",t}return e=i,(o=[{key:"addTo",value:function(t){var e=this;this.controls_.push(new B(this.options_)),this.map_=t,this.panel_=new M.ui.Panel("panelTopographicprofile",{className:"m-topographicprofile",collapsedButtonClass:"icon-chart",position:M.ui.position[this.position_],tooltip:a("tooltip")}),this.panel_.addControls(this.controls_),this.panel_.on(M.evt.ADDED_TO_MAP,(function(){e.fire(M.evt.ADDED_TO_MAP)})),t.addPanels(this.panel_)}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.position_)}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var t=[null,null,null];this.map_=t[0],this.controls_=t[1],this.panel_=t[2]}},{key:"name",get:function(){return"topographicprofile"}}])&&U(e.prototype,o),n&&U(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Topographicprofile=W,window.M.control.Topographicprofilecontrol=B,window.M.impl.control.TopographicprofileControl=j}]);
//# sourceMappingURL=topographicprofile.ol.min.js.map